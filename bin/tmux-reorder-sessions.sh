#!/bin/bash
# ============================================================
# tmux-reorder-sessions.sh
# ============================================================
#
# 概要:
#   tmuxのセッション番号を連番に整理するスクリプト
#
# 用途:
#   tmuxでセッションを作成・削除を繰り返すと、セッション番号が
#   歯抜けになることがある（例: 0, 1, 5, 7）
#   このスクリプトで番号を0から連番に振り直す（0, 1, 2, 3）
#
# 機能:
#   - 数字で始まるセッション名のみを対象
#   - セッション番号を0から順に振り直し
#   - セッション内容は変更されない（名前のみ変更）
#
# 依存関係:
#   - tmux
#   - grep
#   - cut
#   - sort
#
# 使用例:
#   $ tmux ls
#   0: 1 windows (created Mon Dec 30 18:00:00 2025)
#   3: 2 windows (created Mon Dec 30 18:05:00 2025)
#   7: 1 windows (created Mon Dec 30 18:10:00 2025)
#
#   $ ./tmux-reorder-sessions.sh
#
#   $ tmux ls
#   0: 1 windows (created Mon Dec 30 18:00:00 2025)
#   1: 2 windows (created Mon Dec 30 18:05:00 2025)
#   2: 1 windows (created Mon Dec 30 18:10:00 2025)
#
# 注意事項:
#   - 実行中のセッションに対しても名前変更が行われます
#   - アタッチ中のセッションの番号が変わる可能性があります
#
# ============================================================

# 数字で始まるセッション名を取得して昇順にソート
# tmux ls: セッション一覧を表示
# grep -E '^[0-9]*:': 数字で始まる行のみ抽出
# cut -f1 -d':': コロンの前の部分（セッション名）を抽出
# sort: 数値順にソート
sessions=$(tmux ls | grep -E '^[0-9]*:' | cut -f1 -d':' | sort)

# 新しいセッション番号（0から開始）
new=0

# 各セッションを順に処理
for old in $sessions; do
	# セッション名を変更
	# -t: ターゲットセッション（変更元）
	# 第2引数: 新しいセッション名
	tmux rename -t $old $new

	# 新しいセッション番号をインクリメント
	((new++))
done
